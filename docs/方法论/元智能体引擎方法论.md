# 元智能体引擎方法论 v1.0

## 目录

1. [概述](#1-概述)
2. [元智能体体系](#2-元智能体体系)
3. [记忆系统](#3-记忆系统)
4. [个人知识库](#4-个人知识库)
5. [多任务协同](#5-多任务协同)
6. [上下文管理](#6-上下文管理)
7. [工具集成](#7-工具集成)
8. [可观测性](#8-可观测性)

---

## 1. 概述

### 1.1 核心愿景

构建一套**"生产智能体的智能体系统"**——元智能体引擎（Meta-Agent Engine）。

### 1.2 核心能力

| 能力 | 说明 |
|------|------|
| **生产** | 根据用户意图，自动生产业务智能体 |
| **派生** | 支持智能体的层级派生，从通用到专业逐级深化 |
| **协同** | 多智能体按标准化流程协作完成任务 |
| **记忆** | 长期存储知识、经验、用户偏好 |
| **学习** | 从历史执行中学习，持续优化 |
| **个性化** | 基于用户个人知识库定制智能体 |

### 1.3 系统架构总览

```
┌─────────────────────────────────────────────────────────────┐
│                     元智能体引擎                              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │ 元智能体体系 │  │  记忆系统   │  │ 个人知识库  │         │
│  │  (8角色)    │  │ (长期/短期) │  │ (用户经验)  │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │ 多任务协同  │  │ 上下文管理  │  │  工具集成   │         │
│  │ (队列/调度) │  │ (会话/状态) │  │ (MCP/API)  │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
│                                                             │
│  ┌─────────────────────────────────────────────────┐       │
│  │                  可观测性                        │       │
│  │            (日志/监控/追踪/审计)                 │       │
│  └─────────────────────────────────────────────────┘       │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 2. 元智能体体系

### 2.1 角色矩阵

系统定义 **8 个核心元角色**，分为 4 个职能组：

| 职能组 | 角色 | 中文名 | 核心职责 |
|--------|------|--------|----------|
| **情报组** | Researcher | 情报研究员 | 检索外部最佳实践、行业标准 |
| | Asset Manager | 资产管家 | 管理内部Agent模板、Prompt组件 |
| **设计组** | Architect | 架构师 | 拆解意图，设计智能体蓝图 |
| | Weaver | 织造者 | 编写System Prompt |
| **执行组** | Choreographer | 编排者 | 设计协作拓扑（DAG/状态机） |
| | Orchestrator | 调度者 | 运行时调度执行 |
| **运维组** | Evaluator | 评估者 | 质量评估，拥有否决权 |
| | Learner | 学习者 | 从历史中提取模式 |

### 2.2 协同流程

```
用户意图 → [Researcher + Asset Manager] → [Architect] → [Weaver + Choreographer] → [Orchestrator] → [Evaluator] → [Learner]
```

### 2.3 层级派生机制

**核心公式**：派生 = 继承 + 特化 + 约束

| 层级 | 说明 | 示例 |
|------|------|------|
| L0 | 通用智能体 | 医生 |
| L1 | 领域智能体 | 内科医生 |
| L2 | 专科智能体 | 胃肠科医生 |
| L3 | 细分智能体 | 胃镜专家 |

**触发条件**：粒度不足、质量不达标、频率阈值

> 详细定义见附录A

---

## 3. 记忆系统

### 3.1 记忆分层

| 层级 | 类型 | 存储周期 | 用途 |
|------|------|----------|------|
| L1 | **工作记忆** | 单次会话 | 当前任务上下文 |
| L2 | **短期记忆** | 跨会话（天级） | 近期交互历史 |
| L3 | **长期记忆** | 持久化 | 知识、经验、模式 |

### 3.2 存储方案

| 记忆类型 | 存储技术 | 检索方式 |
|----------|----------|----------|
| 结构化知识 | 知识图谱 | 图查询 |
| 非结构化内容 | 向量数据库 | 语义检索 |
| 执行历史 | 关系数据库 | SQL查询 |
| 用户偏好 | KV存储 | 键值查询 |

### 3.3 记忆生命周期

```
输入 → 编码 → 存储 → 检索 → 遗忘/强化
```

> TODO: 详细设计待补充

---

## 4. 个人知识库

### 4.1 核心问题

**如何让元智能体快速了解一个人？**

### 4.2 知识来源

| 来源 | 方式 | 说明 |
|------|------|------|
| **主动注入** | 用户上传 | 文档、方法论、经验总结 |
| **交互学习** | 对话提取 | 从历史对话中提取偏好 |
| **反馈学习** | 修正记录 | 用户对输出的修正和评价 |
| **行为观察** | 模式识别 | 决策模式、习惯 |

### 4.3 知识优先级

Researcher查询顺序：
1. **个人知识库** → 用户自己的经验（最高优先）
2. **Asset Manager** → 系统已有资产
3. **互联网** → 外部最佳实践（最低优先）

### 4.4 个人画像结构

```json
{
  "user_id": "user-001",
  "domains": ["软件开发", "项目管理"],
  "methodologies": ["敏捷", "DDD"],
  "preferences": {"output_format": "简洁", "detail_level": "高"},
  "decision_patterns": [...],
  "custom_agents": [...]
}
```

> TODO: 个人知识库详细设计待补充

---

## 5. 多任务协同

### 5.1 任务模型

| 维度 | 说明 |
|------|------|
| **任务队列** | 待执行任务的有序列表 |
| **优先级** | 紧急/高/中/低 |
| **依赖关系** | 任务间的前置条件 |
| **并发控制** | 最大并行任务数 |

### 5.2 调度策略

| 策略 | 适用场景 |
|------|----------|
| FIFO | 默认，先进先出 |
| 优先级调度 | 有紧急任务时 |
| 依赖调度 | 任务间有依赖时 |

### 5.3 任务状态

```
pending → running → completed / failed
```

> TODO: 多任务协同详细设计待补充

---

## 6. 上下文管理

### 6.1 上下文类型

| 类型 | 作用域 | 说明 |
|------|--------|------|
| **会话上下文** | 单次会话 | 当前对话的历史 |
| **任务上下文** | 单个任务 | 任务执行的中间状态 |
| **用户上下文** | 跨会话 | 用户偏好、历史 |
| **全局上下文** | 系统级 | 系统配置、共享知识 |

### 6.2 上下文传递

```
Agent A → [上下文路由] → Agent B
              ↓
         过滤/转换/压缩
```

> TODO: 上下文管理详细设计待补充

---

## 7. 工具集成

### 7.1 工具类型

| 类型 | 说明 | 示例 |
|------|------|------|
| **内置工具** | 系统自带 | 文件读写、搜索 |
| **MCP工具** | 标准协议 | 第三方MCP服务 |
| **API工具** | 外部接口 | REST/GraphQL |
| **自定义工具** | 用户扩展 | 脚本、插件 |

### 7.2 工具注册

```json
{
  "tool_id": "web_search",
  "name": "网络搜索",
  "protocol": "MCP",
  "endpoint": "...",
  "permissions": ["read"]
}
```

> TODO: 工具集成详细设计待补充

---

## 8. 可观测性

### 8.1 观测维度

| 维度 | 说明 |
|------|------|
| **日志** | 执行过程记录 |
| **监控** | 性能指标、健康状态 |
| **追踪** | 请求链路追踪 |
| **审计** | 操作记录、合规检查 |

### 8.2 关键指标

| 指标 | 说明 |
|------|------|
| 任务成功率 | 完成/总数 |
| 平均响应时间 | 从请求到响应 |
| Agent调用次数 | 各Agent使用频率 |
| 派生触发次数 | 新智能体生成频率 |

> TODO: 可观测性详细设计待补充

---

## 附录

### 附录A：元智能体详细定义

> 包含8个角色的完整Prompt模板、输入输出规范、技能列表、边界定义
>
> TODO: 待补充

### 附录B：数据结构定义

> 包含Agent、Blueprint、Workflow、Execution等核心数据结构
>
> TODO: 待补充

---

## 版本记录

| 版本 | 日期 | 变更 |
|------|------|------|
| v1.0 | 2025-02-01 | 初始版本，建立章节框架 |
