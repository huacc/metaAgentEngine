# 元智能体角色分工矩阵

## 1. 角色总览

元智能体层由 **6 个核心角色** 组成，形成完整的智能体生产流水线：

```
┌──────────────────────────────────────────────────────────────┐
│                        元智能体层                              │
│                                                              │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐               │
│  │Librarian │───→│ Architect│───→│  Weaver  │               │
│  │ 情报官   │    │ 架构师   │    │ 织造者   │               │
│  └──────────┘    └──────────┘    └──────────┘               │
│       ↑              ↓               ↓                       │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐               │
│  │  Asset   │←───│Choreogra-│←───│Evaluator │               │
│  │ Manager  │    │  pher    │    │ 评估官   │               │
│  │ 资产管家 │    │ 编排官   │    └──────────┘               │
│  └──────────┘    └──────────┘                               │
└──────────────────────────────────────────────────────────────┘
```

| 序号 | 角色 | 中文名 | 核心职责 | 类比 |
|------|------|--------|----------|------|
| 1 | **Librarian** | 情报官 | 检索外部最佳实践和行业标准 | 情报员 |
| 2 | **Asset Manager** | 资产管家 | 管理内部Agent模板和流程蓝图 | 仓库管理员 |
| 3 | **Architect** | 架构师 | 拆解意图，设计智能体蓝图 | 司令官 |
| 4 | **Weaver** | 织造者 | 编写Prompt，赋予智能体灵魂 | 工程师 |
| 5 | **Choreographer** | 编排官 | 构建协作拓扑，定义数据流转 | 指挥家 |
| 6 | **Evaluator** | 评估官 | 质量验收，拥有最终否决权 | 审计师 |

## 2. 角色详细定义

### 2.1 Librarian（情报官）

**核心职责**：检索外部世界的最佳实践、SOP、行业标准

**关键能力**：
- RAG 检索增强生成
- Web Search 网络搜索
- 知识提纯与结构化

**输入**：
- 用户查询领域 `[DOMAIN]`
- 具体任务描述 `[USER_QUERY]`

**输出**：
```json
{
  "domain": "软件开发-Web应用",
  "key_best_practices": ["敏捷开发", "CI/CD", "代码审查"],
  "recommended_agent_structure": ["需求分析师", "架构师", "开发者", "测试员"],
  "common_pitfalls": ["需求蔓延", "技术债务累积"],
  "recommended_tools": ["Git", "Jira", "SonarQube"],
  "sources": ["https://...", "https://..."],
  "confidence": 0.85
}
```

**System Prompt 核心**：
```
你是一个专业的领域研究员兼情报分析师。
请从以下维度全面收集该领域的最佳实践：
1. 当前最主流的技术栈/方法论/流程
2. 顶级公司或项目的成熟实践案例
3. 推荐的子智能体分工结构
4. 常见失败模式和风险点
5. 关键工具推荐
```

---

### 2.2 Asset Manager（资产管家）

**核心职责**：管理内部已有的 Agent 模板、Prompt 组件和流程蓝图

**关键能力**：
- 语义检索
- 版本控制
- 资产匹配与推荐

**输入**：
- 用户查询 `[USER_QUERY]`
- 系统上下文 `[SYSTEM_CONTEXT]`（现有角色列表、历史流程）

**输出**：
```json
{
  "matched": true,
  "recommended_agents": ["代码审查员-v2.1", "测试专家-v1.3"],
  "recommended_prompts": {"reviewer": "...", "tester": "..."},
  "recommended_workflow": "seq: 代码提交 → 审查 → 测试 → 合并",
  "reuse_rate": 0.7,
  "suggestions": "可复用70%现有资产，需新建部署专家"
}
```

**System Prompt 核心**：
```
你是系统模板检索专家。
步骤：
1. 分析查询领域和需求
2. 从系统目录中匹配：现有角色、Prompt组合、流程模式
3. 如果匹配，提供现成配置
4. 如果不匹配，建议新组合或触发外部研究
5. 强调复用优先，避免冗余
```

---

### 2.3 Architect（架构师）

**核心职责**：拆解意图，定义所需的 Agent 列表、职能边界及 I/O 契约

**关键能力**：
- 系统架构设计
- 任务分解
- 依赖分析

**输入**：
- 用户查询 `[USER_QUERY]`
- Librarian 的情报报告
- Asset Manager 的资产匹配结果

**输出**：
```json
{
  "blueprint_name": "代码审计流程",
  "agent_list": [
    {
      "name": "代码扫描员",
      "role": "静态代码分析",
      "goal": "识别潜在漏洞和代码异味",
      "input": "源代码仓库",
      "output": "扫描报告JSON"
    },
    {
      "name": "漏洞分析师",
      "role": "深度漏洞分析",
      "goal": "验证漏洞真实性，评估风险等级",
      "input": "扫描报告",
      "output": "漏洞评估报告"
    }
  ],
  "interaction_contract": {
    "代码扫描员 → 漏洞分析师": "扫描报告JSON",
    "漏洞分析师 → 修复建议员": "漏洞评估报告"
  },
  "workflow_type": "seq"
}
```

**System Prompt 核心**：
```
你是首席系统架构师。
将用户需求转化为"智能体协作蓝图"。
输出协议：必须产出 JSON 格式，明确包含：
- Agent_List (Name, Role, Goal, Input, Output)
- Interaction_Contract (数据流转契约)
原则：追求高内聚低耦合，每个子 Agent 只做一件事。
```

---

### 2.4 Weaver（织造者）

**核心职责**：编写具体的 System Prompt，注入性格、思维框架与约束

**关键能力**：
- Prompt 工程
- 多模型适配
- Few-Shot 示例设计

**输入**：
- Architect 的蓝图 `[BLUEPRINT]`
- 目标模型类型（可选）

**输出**：
```json
{
  "agent_name": "漏洞分析师",
  "system_prompt": "你是一名资深安全专家...",
  "prompt_components": {
    "role_play": "你是一名拥有10年经验的安全专家",
    "task_context": "分析代码扫描报告中的潜在漏洞",
    "thinking_process": "使用STRIDE威胁模型进行分析",
    "output_constraint": "输出JSON格式的漏洞评估报告"
  },
  "few_shot_examples": [...]
}
```

**System Prompt 核心**：
```
你是提示词专家。根据架构师的蓝图，为每个 Agent 编写"灵魂"。
要求必须包含：
- Role-Play（角色扮演）
- Task-Context（任务上下文）
- Thinking-Process（思维过程，CoT）
- Output-Constraint（输出约束）
原则：确保 Agent 具备强烈的行业属性。
```

---

### 2.5 Choreographer（编排官）

**核心职责**：构建 Agent 间的协作拓扑（DAG 或状态机），定义数据流转

**关键能力**：
- 逻辑建模
- 上下文路由
- 异常处理设计

**输入**：
- Architect 的蓝图
- Weaver 生成的 Agent 配置列表

**输出**：
```json
{
  "workflow_name": "代码审计流程",
  "topology": "DAG",
  "nodes": [
    {"id": "scan", "agent": "代码扫描员", "next_on_success": "analyze"},
    {"id": "analyze", "agent": "漏洞分析师", "next_on_success": "fix"}
  ],
  "transitions": [
    {
      "from": "scan",
      "to": "analyze",
      "condition": "scan.output.issues.length > 0",
      "data_mapping": "analyze.input = scan.output"
    }
  ],
  "error_handling": {
    "on_failure": "retry_3_times_then_escalate",
    "escalate_to": "human_reviewer"
  }
}
```

**System Prompt 核心**：
```
你是流程导演。定义数据在 Agent 之间的流转路径。
输出协议：定义状态转移逻辑 Next_Step(If_Success, If_Fail)
确保上下文不丢失，支持条件分支和异常处理。
```

---

### 2.6 Evaluator（评估官）

**核心职责**：模拟对抗测试，验证系统逻辑一致性，拥有最终准入否决权

**关键能力**：
- 压力测试
- 逻辑校验
- 评分 Rubric 应用

**输入**：
- 执行结果 `[RESULTS]`
- 原计划 `[PLAN]`
- 质量标准 `[RUBRIC]`

**输出**：
```json
{
  "evaluation_id": "eval-001",
  "scores": {
    "accuracy": 0.9,
    "completeness": 0.85,
    "efficiency": 0.8
  },
  "overall_score": 0.87,
  "pass": true,
  "feedback": [
    "漏洞分析覆盖率良好",
    "建议增加对SQL注入的深度检测"
  ],
  "action": "approve_and_archive"
}
```

**System Prompt 核心**：
```
你是质量评估专家。
评估准确性、一致性和完整性。
使用评分标准：准确性50%、完整性30%、效率20%
拥有最终否决权，不合格则打回重修。
```

---

## 3. 角色协作矩阵

### 3.1 信息流向

```
用户意图
    ↓
┌───────────────────────────────────────┐
│  Librarian ←──────→ Asset Manager     │  (并行：外部情报 + 内部资产)
└───────────────────────────────────────┘
    ↓ 合并报告
┌───────────────────────────────────────┐
│           Architect                    │  (设计蓝图)
└───────────────────────────────────────┘
    ↓ 蓝图
┌───────────────────────────────────────┐
│  Weaver ──────────→ Choreographer     │  (并行：Prompt + 流程)
└───────────────────────────────────────┘
    ↓ 完整配置
┌───────────────────────────────────────┐
│           Evaluator                    │  (验收)
└───────────────────────────────────────┘
    ↓ 通过/打回
   交付 或 返工
```

### 3.2 职责边界

| 角色 | 知道什么 | 不知道什么 |
|------|----------|------------|
| Librarian | 外部最佳实践 | 内部资产库 |
| Asset Manager | 内部资产库 | 外部最新趋势 |
| Architect | 全局蓝图 | Prompt细节 |
| Weaver | Prompt工程 | 流程编排 |
| Choreographer | 流程拓扑 | Prompt内容 |
| Evaluator | 质量标准 | 具体实现 |

这种**信息隔离**保证了：
- 单个角色的**通用性**（可复用于不同场景）
- 系统的**稳定性**（单点修改不影响全局）
- 职责的**清晰性**（出问题容易定位）
