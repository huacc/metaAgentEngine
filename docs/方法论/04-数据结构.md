# 核心数据结构

## 1. 概述

本文档定义元智能体系统中的核心数据结构和契约规范。

## 2. 智能体定义结构

### 2.1 Agent 基础结构

```json
{
  "agent_id": "string",
  "name": "string",
  "version": "string",
  "type": "meta | business",
  "status": "active | inactive | deprecated",

  "lineage": {
    "parent_id": "string | null",
    "root_id": "string",
    "level": "number",
    "children_ids": ["string"]
  },

  "prompt_config": {
    "system_prompt": "string",
    "role_play": "string",
    "task_context": "string",
    "thinking_process": "string",
    "output_constraint": "string"
  },

  "capabilities": {
    "skills": ["string"],
    "tools": ["string"],
    "knowledge_domains": ["string"]
  },

  "constraints": ["string"],

  "metadata": {
    "created_at": "datetime",
    "updated_at": "datetime",
    "created_by": "string"
  }
}
```

---

## 3. 蓝图结构

### 3.1 Blueprint 定义

```json
{
  "blueprint_id": "string",
  "name": "string",
  "version": "string",
  "domain": "string",

  "agents": [
    {
      "agent_ref": "string",
      "source": "reuse | new | derive",
      "role_in_workflow": "string"
    }
  ],

  "contracts": {
    "agent_a → agent_b": {
      "data_type": "string",
      "schema": {}
    }
  }
}
```

---

## 4. 工作流结构

### 4.1 Workflow 定义

```json
{
  "workflow_id": "string",
  "name": "string",
  "topology": "seq | par | dag | state_machine",

  "nodes": [
    {
      "id": "string",
      "agent_ref": "string",
      "input_mapping": {},
      "output_mapping": {}
    }
  ],

  "transitions": [
    {
      "from": "string",
      "to": "string",
      "condition": "string",
      "on_success": "string",
      "on_failure": "string"
    }
  ],

  "error_handling": {
    "retry_count": "number",
    "fallback_agent": "string",
    "escalate_to": "string"
  }
}
```

---

## 5. 执行记录

```json
{
  "execution_id": "string",
  "workflow_ref": "string",
  "status": "pending | running | success | failed",
  "started_at": "datetime",
  "completed_at": "datetime",

  "results": [
    {
      "node_id": "string",
      "agent_ref": "string",
      "status": "string",
      "output": {},
      "duration_ms": "number"
    }
  ]
}
```

---

## 6. 派生请求

```json
{
  "derive_request_id": "string",
  "parent_agent_id": "string",
  "trigger": "quality_issue | capability_gap | frequency_threshold",
  "trigger_context": {},

  "specialization": {
    "new_name": "string",
    "domain_focus": "string",
    "additional_skills": ["string"],
    "additional_constraints": ["string"]
  },

  "status": "pending | approved | rejected",
  "result_agent_id": "string | null"
}
```

---

## 7. 评估结果

```json
{
  "evaluation_id": "string",
  "target_type": "execution | agent | workflow",
  "target_id": "string",

  "scores": {
    "accuracy": "number (0-1)",
    "completeness": "number (0-1)",
    "efficiency": "number (0-1)"
  },
  "overall_score": "number (0-1)",

  "pass": "boolean",
  "feedback": ["string"],
  "action": "approve | reject | revise"
}
```
